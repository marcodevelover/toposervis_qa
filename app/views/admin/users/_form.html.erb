<%= simple_form_for([:admin, @user], remote: request.xhr?, html: { data: { modal: true } }) do |form| %>               
                  
<div class="modal-body">
  <div style="background-color:#f05050; border-color: #f05050; border-radius: 0.25rem; color:white; font-weight:bold;">
        <ul class="errors"></ul>
  </div> 

  <div class="form-group">
        <%= form.label :email, class: "col-form-label"%> *
        <%= form.text_field :email, class: "form-control", type: "email", required: true %>
  </div>

  <div class="form-group">
        <%= form.label :password, class: "col-form-label"%> *
        <%= form.text_field :password, class: "form-control", type: "password", required: true %>
  </div>

  <div class="form-group">
        <%= form.label :name, class: "col-form-label"%> *
        <%= form.text_field :name, class: "form-control", type: "text", required: true %>
  </div>

  <div class="form-group">
        <%= form.label :lastname, class: "col-form-label"%> *
        <%= form.text_field :lastname, class: "form-control", type: "text", required: true %>
  </div>

  <div class="form-group">
        <%= form.label :phone, class: "col-form-label"%>
        <%= form.text_field :phone, class: "form-control", type: "text" %>
  </div>

  <div class="form-group">
    <%= form.label :role_id, class: "col-form-label"%>
    <div class="form-group">
      <%= form.collection_select :role_id, Role.all, :id, :name, {prompt: t('choose_from_select')}, {class: "custom-select custom-select-sm"}  %>
    </div>
  </div>



 <div class="form-group">
   <%= form.label :customers, class: "col-form-label"%>
     <%= form.collection_select :customer_ids, Customer.all, :id, :name, {prompt: t('choose_from_select')}, style: "width: 100%" %>
 </div>

                                 
   <div class="required">* Required fields</div>
</div>
<div class="modal-footer">
   <div class="clearfix">
      <div class="float-right">
        <%= form.submit class: "btn btn-primary" %>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
      </div>
   </div>
</div>
                     
<% end %>



<script type="text/javascript">

$("#user_customer_ids").select2({
  ajax: {
    url: '/admin/<%=controller_name%>/customers',
    dataType: 'json',
    delay: 250,
    data: function (params) {
      return {
        q: {name_cont: params.term}, // search term
        page: params.page
      };
    },
    processResults: function (data, params) {
      // parse the results into the format expected by Select2
      // since we are using custom formatting functions we do not need to
      // alter the remote JSON data, except to indicate that infinite
      // scrolling can be used
      params.page = params.page || 1;

      return {
        results: data.customers,
        pagination: {
          more: (params.page * 30) < data.total_count
        }
      };
    },
    cache: true
  },
  placeholder: 'Buscar Cliente',
  allowClear: true,
  minimumInputLength: 1,
  templateResult: formatRepo,
  templateSelection: formatRepoSelection
});

function formatRepo (repo) {
  if (repo.loading) {
    return repo.text;
  }

  var $container = $(
    "<div class='select2-result-repository clearfix'>" +
      "<div class='select2-result-repository__meta'>" +
        "<div class='select2-result-repository__abbreviation'>Nombre: </div>" +
      "</div>" +
    "</div>"
  );


  $container.find(".select2-result-repository__abbreviation").append(repo.name);
  
  return $container;
}

function formatRepoSelection (repo) {
  return repo.name || repo.text;
}

</script>
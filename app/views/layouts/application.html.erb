<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
   <meta name="description" content="CRM Toposervis">
   <meta name="keywords" content="CRM Toposervis">
   <title>CRM - Toposervis</title>
   <%= favicon_link_tag asset_path('favicon.ico') %>

   <!-- =============== VIEW STYLES ===============-->
   
   <!-- =============== APP STYLES ===============-->
   <%= stylesheet_link_tag 'application', media: 'all', id: "maincss" %>

   <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
   <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>
   <%= javascript_include_tag Ckeditor.cdn_url %>

   <meta name="turbolinks-cache-control" content="no-cache">

   <%= yield :vendor_css_area %>

   <%= csrf_meta_tags %>
   <%= csp_meta_tag %>
</head>

<body>
   <div class="wrapper">
      <!-- top navbar-->
      <header class="topnavbar-wrapper">
         <%= render partial: "layouts/partials/topnavbar" %>
      </header>
      <!-- sidebar-->
      <aside class="aside-container">
         <%= render partial: "layouts/partials/sidebar" %>
      </aside>
      <!-- offsidebar-->
      <aside class="offsidebar d-none">
         <%= render partial: "layouts/partials/offsidebar" %>
      </aside>
      <!-- Main section-->
      <section class="section-container">
         <!-- Page content-->
         <div class="content-wrapper">
            <%= title_section(@page_name) %>
            <%= yield %>
         </div>
      </section>
      <!-- Page footer-->
      <footer class="footer-container">
         <%= render partial: "layouts/partials/footer" %>
      </footer>
   </div>

   <!-- =============== APP SCRIPTS ===============-->
   <%= javascript_packs_with_chunks_tag 'application', params[:controller] if pack_exists?(params[:controller]) %>
   

   <%= yield :vendor_js_area %>

   <%= yield :body_area %>

  
<div id="modal-holder"></div>


</body>
<script type="text/javascript">
   
$(function() {
  const modal_holder_selector = '#modal-holder';
  const modal_selector = '.modal';

  $(document).on('click', 'a[data-modal]', function() {
    const location = $(this).attr('href');
    // Load modal dialog from server
    $.get(
      location,
      data => { $(modal_holder_selector).html(data).find(modal_selector).modal();
      $('.modal-dialog').draggable({
    handle: ".modal-header"
  }); }
    );
    return false;
  });

  $(document).on('ajax:success', 'form{data-modal}', function(event){ 
    const [data, _status, xhr] = event.detail;
    const url = xhr.getResponseHeader('Location');
    if (url) {
      // Redirect to url
      window.location = url;
    }  

    return false;
  });
});
</script>

</html>